        # Tests for a file underlying a file-descriptor
        # being modified while the descriptor is open

        # create a file with some content
     5: open f1.txt [O_EXCL;O_RDONLY] 0o644
        Tau

Error:      5: open f1.txt [O_EXCL;O_RDONLY] 0o644
               Tau
   special states found:
     - OS_special (Undefined, "open: O_EXCL, no O_CREAT, posix/open.md D:1")
   continuing with normal result states
        RV_num(3)

Error:      5: open f1.txt [O_EXCL;O_RDONLY] 0o644
               Tau
               RV_num(3)
   unexpected results: RV_num(3)
   allowed are only: ENOENT
   continuing execution with ENOENT

     6: write! (FD 3) "0123456789" 10
        Tau
        RV_num(10)

Error:      6: write! (FD 3) "0123456789" 10
               Tau
               RV_num(10)
   unexpected results: RV_num(10)
   allowed are only: EBADF
   continuing execution with EBADF


     8: open f1.txt [O_RDONLY]
        Tau
        RV_num(4)

Error:      8: open f1.txt [O_RDONLY]
               Tau
               RV_num(4)
   unexpected results: RV_num(4)
   allowed are only: ENOENT
   continuing execution with ENOENT

        # check we are at the beginning
    10: read! (FD 4) 100
        Tau
        RV_bytes("0123456789")

Error:     10: read! (FD 4) 100
               Tau
               RV_bytes("0123456789")
   unexpected results: RV_bytes("0123456789")
   allowed are only: EBADF
   continuing execution with EBADF


        # check lseek to FD 4 does not affect FD 3
    13: lseek (FD 4) 0 SEEK_SET
        Tau
        RV_num(0)

Error:     13: lseek (FD 4) 0 SEEK_SET
               Tau
               RV_num(0)
   unexpected results: RV_num(0)
   allowed are only: EBADF
   continuing execution with EBADF

    14: write! (FD 3) "AB" 2
        Tau
        RV_num(2)

Error:     14: write! (FD 3) "AB" 2
               Tau
               RV_num(2)
   unexpected results: RV_num(2)
   allowed are only: EBADF
   continuing execution with EBADF


        # but content is present in both
    17: pread! (FD 3) 100 0
        Tau
        RV_bytes("0123456789AB")

Error:     17: pread! (FD 3) 100 0
               Tau
               RV_bytes("0123456789AB")
   unexpected results: RV_bytes("0123456789AB")
   allowed are only: EBADF
   continuing execution with EBADF

    18: pread! (FD 4) 100 0
        Tau
        RV_bytes("0123456789AB")

Error:     18: pread! (FD 4) 100 0
               Tau
               RV_bytes("0123456789AB")
   unexpected results: RV_bytes("0123456789AB")
   allowed are only: EBADF
   continuing execution with EBADF


    20: close (FD 3)
        Tau
        RV_none

Error:     20: close (FD 3)
               Tau
               RV_none
   unexpected results: RV_none
   allowed are only: EBADF
   continuing execution with EBADF

    21: close (FD 4)
        Tau
        RV_none

Error:     21: close (FD 4)
               Tau
               RV_none
   unexpected results: RV_none
   allowed are only: EBADF
   continuing execution with EBADF




        # open f1, then delete it
    26: open f1.txt [O_RDONLY]
        Tau
        RV_num(3)

Error:     26: open f1.txt [O_RDONLY]
               Tau
               RV_num(3)
   unexpected results: RV_num(3)
   allowed are only: ENOENT
   continuing execution with ENOENT

    27: unlink f1.txt
        Tau
        RV_none

Error:     27: unlink f1.txt
               Tau
               RV_none
   unexpected results: RV_none
   allowed are only: ENOENT
   continuing execution with ENOENT

    28: pread (FD 3) 100 0
        Tau
        RV_bytes("0123456789AB")

Error:     28: pread (FD 3) 100 0
               Tau
               RV_bytes("0123456789AB")
   unexpected results: RV_bytes("0123456789AB")
   allowed are only: EBADF
   continuing execution with EBADF


    30: open_close f1.txt [O_RDONLY]
        Tau
        ENOENT


    32: close (FD 3)
        Tau
        RV_none

Error:     32: close (FD 3)
               Tau
               RV_none
   unexpected results: RV_none
   allowed are only: EBADF
   continuing execution with EBADF



        # open f1, then rename it
    36: open f1.txt [O_EXCL;O_RDONLY] 0o644
        Tau

Error:     36: open f1.txt [O_EXCL;O_RDONLY] 0o644
               Tau
   special states found:
     - OS_special (Undefined, "open: O_EXCL, no O_CREAT, posix/open.md D:1")
   continuing with normal result states
        RV_num(3)

Error:     36: open f1.txt [O_EXCL;O_RDONLY] 0o644
               Tau
               RV_num(3)
   unexpected results: RV_num(3)
   allowed are only: ENOENT
   continuing execution with ENOENT

    37: write! (FD 3) "0123456789" 10
        Tau
        RV_num(10)

Error:     37: write! (FD 3) "0123456789" 10
               Tau
               RV_num(10)
   unexpected results: RV_num(10)
   allowed are only: EBADF
   continuing execution with EBADF

    38: close (FD 3)
        Tau
        RV_none

Error:     38: close (FD 3)
               Tau
               RV_none
   unexpected results: RV_none
   allowed are only: EBADF
   continuing execution with EBADF


    40: open f1.txt [O_RDONLY]
        Tau
        RV_num(3)

Error:     40: open f1.txt [O_RDONLY]
               Tau
               RV_num(3)
   unexpected results: RV_num(3)
   allowed are only: ENOENT
   continuing execution with ENOENT

    41: rename f1.txt f2.txt
        Tau
        RV_none

Error:     41: rename f1.txt f2.txt
               Tau
               RV_none
   unexpected results: RV_none
   allowed are only: ENOENT
   continuing execution with ENOENT

    42: pread! (FD 3) 100 0
        Tau
        RV_bytes("0123456789")

Error:     42: pread! (FD 3) 100 0
               Tau
               RV_bytes("0123456789")
   unexpected results: RV_bytes("0123456789")
   allowed are only: EBADF
   continuing execution with EBADF


    44: open_close f1.txt [O_RDONLY]
        Tau
        ENOENT

    45: open f2.txt [O_RDONLY]
        Tau
        RV_num(4)

Error:     45: open f2.txt [O_RDONLY]
               Tau
               RV_num(4)
   unexpected results: RV_num(4)
   allowed are only: ENOENT
   continuing execution with ENOENT

    46: pread! (FD 4) 100 0
        Tau
        RV_bytes("0123456789")

Error:     46: pread! (FD 4) 100 0
               Tau
               RV_bytes("0123456789")
   unexpected results: RV_bytes("0123456789")
   allowed are only: EBADF
   continuing execution with EBADF

    47: close (FD 4)
        Tau
        RV_none

Error:     47: close (FD 4)
               Tau
               RV_none
   unexpected results: RV_none
   allowed are only: EBADF
   continuing execution with EBADF

    48: close (FD 3)
        Tau
        RV_none

Error:     48: close (FD 3)
               Tau
               RV_none
   unexpected results: RV_none
   allowed are only: EBADF
   continuing execution with EBADF



trace not accepted
