# processing file 'exec_adhoc_file_descriptor_change_tests-int.trace' ...
        # processing file 'adhoc_file_descriptor_change_tests-int.trace' ...
        @type trace
        # Tests for a file underlying a file-descriptor
        # being modified while the descriptor is open

        # create a file with some content
     7: open "f1.txt" [O_CREAT;O_RDWR] 0o644
     8: Tau
     9: RV_num(3)
    10: write! (FD 3) "0123456789" 10
    11: Tau
    12: RV_num(10)

    14: open "f1.txt" [O_RDONLY]
    15: Tau
    16: RV_num(4)
        # check we are at the beginning
    18: read! (FD 4) 100
    19: Tau
    20: RV_bytes("0123456789")

        # check lseek to FD 4 does not affect FD 3
    23: lseek (FD 4) 0 SEEK_SET
    24: Tau
    25: RV_num(0)
    26: write! (FD 3) "AB" 2
    27: Tau
    28: RV_num(2)

        # but content is present in both
    31: pread! (FD 3) 100 0
    32: Tau
    33: RV_bytes("0123456789AB")
    34: pread! (FD 4) 100 0
    35: Tau
    36: RV_bytes("0123456789AB")

    38: close (FD 3)
    39: Tau
    40: RV_none
    41: close (FD 4)
    42: Tau
    43: RV_none



        # open f1, then delete it
    48: open "f1.txt" [O_RDONLY]
    49: Tau
    50: RV_num(3)
    51: unlink "f1.txt"
    52: Tau
    53: RV_none
    54: pread (FD 3) 100 0
    55: Tau
    56: RV_bytes("0123456789AB")

Warning:     56: RV_bytes("0123456789AB")
   more than one possible result value

    58: open_close "f1.txt" [O_RDONLY]
    59: Tau
    60: ENOENT

    62: close (FD 3)
    63: Tau
    64: RV_none


        # open f1, then rename it
    68: open "f1.txt" [O_CREAT;O_RDWR] 0o644
    69: Tau
    70: RV_num(3)
    71: write! (FD 3) "0123456789" 10
    72: Tau
    73: RV_num(10)
    74: close (FD 3)
    75: Tau
    76: RV_none

    78: open "f1.txt" [O_RDONLY]
    79: Tau
    80: RV_num(3)
    81: rename "f1.txt" "f2.txt"
    82: Tau
    83: RV_none
    84: pread! (FD 3) 100 0
    85: Tau
    86: RV_bytes("0123456789")

    88: open_close "f1.txt" [O_RDONLY]
    89: Tau
    90: ENOENT
    91: open "f2.txt" [O_RDONLY]
    92: Tau
    93: RV_num(4)
    94: pread! (FD 4) 100 0
    95: Tau
    96: RV_bytes("0123456789")
    97: close (FD 4)
    98: Tau
    99: RV_none
   100: close (FD 3)
   101: Tau
   102: RV_none




# trace accepted
