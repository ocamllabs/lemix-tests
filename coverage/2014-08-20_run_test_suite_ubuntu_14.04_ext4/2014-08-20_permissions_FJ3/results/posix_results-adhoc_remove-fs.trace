###########################################
# Testing removing files and directories
###########################################

# create dirs with various permissions and
# a file and dir inside it
mkdir /tmp_dir_rwx/ 0o777
Tau
RV_none

open_close /tmp_dir_rwx/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_rwx/subdir 0o777
Tau
RV_none

chmod /tmp_dir_rwx/ 0o700
Tau
RV_none


mkdir /tmp_dir_rwt/ 0o777
Tau
RV_none

open_close /tmp_dir_rwt/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_rwt/subdir 0o777
Tau
RV_none

chmod /tmp_dir_rwt/ 0o1700
Tau
RV_none


mkdir /tmp_dir_rw/ 0o777
Tau
RV_none

open_close /tmp_dir_rw/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_rw/subdir 0o777
Tau
RV_none

chmod /tmp_dir_rw/ 0o600
Tau
RV_none


mkdir /tmp_dir_rx/ 0o777
Tau
RV_none

open_close /tmp_dir_rx/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_rx/subdir 0o777
Tau
RV_none

chmod /tmp_dir_rx/ 0o500
Tau
RV_none


mkdir /tmp_dir_r/ 0o777
Tau
RV_none

open_close /tmp_dir_r/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_r/subdir 0o777
Tau
RV_none

chmod /tmp_dir_r/ 0o400
Tau
RV_none


mkdir /tmp_dir_wx/ 0o777
Tau
RV_none

open_close /tmp_dir_wx/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_wx/subdir 0o777
Tau
RV_none

chmod /tmp_dir_wx/ 0o300
Tau
RV_none


mkdir /tmp_dir_w/ 0o777
Tau
RV_none

open_close /tmp_dir_w/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_w/subdir 0o777
Tau
RV_none

chmod /tmp_dir_w/ 0o200
Tau
RV_none


mkdir /tmp_dir_wt/ 0o777
Tau
RV_none

open_close /tmp_dir_wt/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_wt/subdir 0o777
Tau
RV_none

chmod /tmp_dir_wt/ 0o1300
Tau
RV_none


mkdir /tmp_dir_rwx/ 0o777
Tau
EEXIST

open_close /tmp_dir_rwx/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_rwx/subdir 0o777
Tau
EEXIST

chmod /tmp_dir_x/ 0o100
Tau
ENOENT


mkdir /tmp_dir_/ 0o777
Tau
RV_none

open_close /tmp_dir_/file.txt [O_CREAT;O_RDWR] 0o666
Tau
RV_none

mkdir /tmp_dir_/subdir 0o666
Tau
RV_none

chmod /tmp_dir_/ 0o000
Tau
RV_none



# trying to delete the file
unlink /tmp_dir_rwx/file.txt
Tau
RV_none

unlink /tmp_dir_rwt/file.txt
Tau
RV_none

unlink /tmp_dir_rw/file.txt
Tau
EACCES

unlink /tmp_dir_rx/file.txt
Tau
EACCES

unlink /tmp_dir_r/file.txt
Tau
EACCES

unlink /tmp_dir_wx/file.txt
Tau
RV_none

unlink /tmp_dir_wt/file.txt
Tau
RV_none

unlink /tmp_dir_w/file.txt
Tau
EACCES

unlink /tmp_dir_x/file.txt
Tau
ENOENT

unlink /tmp_dir_/file.txt
Tau
EACCES


# trying to delete the dir
rmdir /tmp_dir_rwx/subdir
Tau
RV_none

rmdir /tmp_dir_rwt/subdir
Tau
RV_none

rmdir /tmp_dir_rw/subdir
Tau
EACCES

rmdir /tmp_dir_rx/subdir
Tau
EACCES

rmdir /tmp_dir_r/subdir
Tau
EACCES

rmdir /tmp_dir_wx/subdir
Tau
RV_none

rmdir /tmp_dir_wt/subdir
Tau
RV_none

rmdir /tmp_dir_w/subdir
Tau
EACCES

rmdir /tmp_dir_x/subdir
Tau
ENOENT

rmdir /tmp_dir_/subdir
Tau
EACCES


dump-result
   /|D|3935847
   /tmp_dir_|D|4857138
   /tmp_dir_/file.txt|F|4857139|0|da39a3ee5e6b4b0d3255bfef95601890afd80709
   /tmp_dir_/subdir|D|4866614
   /tmp_dir_r|D|4596326
   /tmp_dir_r/file.txt|F|4596327|0|da39a3ee5e6b4b0d3255bfef95601890afd80709
   /tmp_dir_r/subdir|D|4596328
   /tmp_dir_rw|D|4465061
   /tmp_dir_rw/file.txt|F|4465062|0|da39a3ee5e6b4b0d3255bfef95601890afd80709
   /tmp_dir_rw/subdir|D|4465063
   /tmp_dir_rwt|D|4328736
   /tmp_dir_rwx|D|4067084
   /tmp_dir_rx|D|4465064
   /tmp_dir_rx/file.txt|F|4465065|0|da39a3ee5e6b4b0d3255bfef95601890afd80709
   /tmp_dir_rx/subdir|D|4596325
   /tmp_dir_w|D|4722460
   /tmp_dir_w/file.txt|F|4722461|0|da39a3ee5e6b4b0d3255bfef95601890afd80709
   /tmp_dir_w/subdir|D|4857135
   /tmp_dir_wt|D|4722462
   /tmp_dir_wx|D|4721938
end dump-result
