# processing file 'adhoc_link_count-int.trace' ...
        @type trace

        ###########################################
        # Test link count of files after link
        ###########################################

        # a new created file should have link count 1

     9: open_close "/f1.txt" [O_RDONLY;O_CREAT] 0o666
        Tau
        RV_none
    10: stat "/f1.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=1; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }

        # after linking the file, both the link and the file should have link count 2

    14: link "/f1.txt" "/f2_hl.txt"
        Tau
        RV_none
    15: stat "/f1.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }
    16: stat "/f2_hl.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }

        # keep linking the file should keep increasing the link count

    20: link "/f1.txt" "/f2_hl1.txt"
        Tau
        RV_none
    21: stat "/f1.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=3; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }
    22: stat "/f2_hl.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=3; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }
    23: stat "/f2_hl1.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=3; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }

    25: link "/f1.txt" "/f2_hl2.txt"
        Tau
        RV_none
    26: stat "/f1.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=4; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }
    27: stat "/f2_hl.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=4; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }
    28: stat "/f2_hl1.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=4; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }
    29: stat "/f2_hl2.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=4; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1418235829;tv_nsec=643335103;}; st_mtim={tv_sec=1418235829;tv_nsec=643335103;}; st_ctim={tv_sec=1418235829;tv_nsec=643335103;}; }

        ## uncomment this test when we have lstat in place
        # linking a symlink should increase the symlink link count

        #symlink "/f1.txt" "f3_sl.txt"
        #link "f3_sl.txt" "f3_sl_hl.txt"
        #lstat "f3_sl.txt"
        #lstat "f3_sl_hl.txt"


