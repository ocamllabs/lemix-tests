# processing file 'exec_adhoc_link_count-int.trace' ...
        # processing file 'adhoc_link_count-int.trace' ...
        @type trace

        ###########################################
        # Test link count of files after link
        ###########################################

        # a new created file should have link count 1

    10: open_close "/f1.txt" [O_RDONLY;O_CREAT] 0o666
    11: Tau
    12: RV_none
    13: stat "/f1.txt"
    14: Tau
    15: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=1; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }

        # after linking the file, both the link and the file should have link count 2

    19: link "/f1.txt" "/f2_hl.txt"
    20: Tau
    21: RV_none
    22: stat "/f1.txt"
    23: Tau
    24: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }
    25: stat "/f2_hl.txt"
    26: Tau
    27: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }

        # keep linking the file should keep increasing the link count

    31: link "/f1.txt" "/f2_hl1.txt"
    32: Tau
    33: RV_none
    34: stat "/f1.txt"
    35: Tau
    36: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=3; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }
    37: stat "/f2_hl.txt"
    38: Tau
    39: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=3; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }
    40: stat "/f2_hl1.txt"
    41: Tau
    42: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=3; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }

    44: link "/f1.txt" "/f2_hl2.txt"
    45: Tau
    46: RV_none
    47: stat "/f1.txt"
    48: Tau
    49: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=4; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }
    50: stat "/f2_hl.txt"
    51: Tau
    52: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=4; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }
    53: stat "/f2_hl1.txt"
    54: Tau
    55: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=4; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }
    56: stat "/f2_hl2.txt"
    57: Tau
    58: RV_stat { st_dev=1792; st_ino=13; st_kind=S_IFREG; st_perm=0o644; st_nlink=4; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154168;tv_nsec=343093156;}; st_mtim={tv_sec=1421154168;tv_nsec=343093156;}; st_ctim={tv_sec=1421154168;tv_nsec=343093156;}; }

        ## uncomment this test when we have lstat in place
        # linking a symlink should increase the symlink link count

        #symlink "/f1.txt" "f3_sl.txt"
        #link "f3_sl.txt" "f3_sl_hl.txt"
        #lstat "f3_sl.txt"
        #lstat "f3_sl_hl.txt"



# trace accepted
