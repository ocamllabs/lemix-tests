# processing file 'adhoc_rename_link_count-int.trace' ...
        @type trace

        ###########################################
        # Test link count of files after rename
        ###########################################

        # test that renaming a file with a link does not effect the link count

     9: open_close "/f1.txt" [O_RDONLY;O_CREAT] 0o666
        Tau
        RV_none

    11: link "/f1.txt" "/f1_hl.txt"
        Tau
        RV_none

    13: stat "f1.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

    15: stat "f1_hl.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

    17: rename "f1.txt" "f2.txt"
        Tau
        RV_none

    19: stat "f2.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

    21: stat "f1_hl.txt"
        Tau
        RV_stat { st_dev=1792; st_ino=97922; st_kind=S_IFREG; st_perm=0o644; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=0; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

        # test that renaming a directory changes the count of the parents

    25: mkdir "/nonempty_dir1" 0o777
        Tau
        RV_none

    27: stat "/nonempty_dir1"
        Tau
        RV_stat { st_dev=1792; st_ino=97923; st_kind=S_IFDIR; st_perm=0o755; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=4096; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

    29: mkdir "/nonempty_dir2" 0o777
        Tau
        RV_none

    31: stat "/nonempty_dir2"
        Tau
        RV_stat { st_dev=1792; st_ino=97924; st_kind=S_IFDIR; st_perm=0o755; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=4096; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

    33: mkdir "/nonempty_dir1/mydir" 0o777
        Tau
        RV_none

    35: stat "/nonempty_dir1/mydir"
        Tau
        RV_stat { st_dev=1792; st_ino=97925; st_kind=S_IFDIR; st_perm=0o755; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=4096; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

    37: rename "/nonempty_dir1/mydir" "/nonempty_dir2/mydir"
        Tau
        RV_none

    39: stat "/nonempty_dir1"
        Tau
        RV_stat { st_dev=1792; st_ino=97923; st_kind=S_IFDIR; st_perm=0o755; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=4096; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

    41: stat "/nonempty_dir2"
        Tau
        RV_stat { st_dev=1792; st_ino=97924; st_kind=S_IFDIR; st_perm=0o755; st_nlink=3; st_uid=0; st_gid=0; st_rdev=0; st_size=4096; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }

    43: stat "/nonempty_dir2/mydir"
        Tau
        RV_stat { st_dev=1792; st_ino=97925; st_kind=S_IFDIR; st_perm=0o755; st_nlink=2; st_uid=0; st_gid=0; st_rdev=0; st_size=4096; st_atim={tv_sec=1421154057;tv_nsec=939763069;}; st_mtim={tv_sec=1421154057;tv_nsec=939763069;}; st_ctim={tv_sec=1421154057;tv_nsec=939763069;}; }


